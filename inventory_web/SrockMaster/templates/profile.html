{% extends 'base.html' %}
{% block title %}Profile - StockPro{% endblock %}
{% block content %}
<h1>Profile</h1>
<div class="form-section" style="max-width:500px;margin:auto;">
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div style="text-align:center;">
            {% if profile_pic_b64 %}
                <img id="profile-pic-preview" src="data:image/png;base64,{{ profile_pic_b64 }}" alt="Profile Picture" style="width:120px;height:120px;object-fit:cover;border-radius:50%;border:2px solid #ccc;display:block;margin:auto;">
            {% else %}
                <img id="profile-pic-preview" src="https://ui-avatars.com/api/?name={{ user.username }}" alt="Profile Picture" style="width:120px;height:120px;object-fit:cover;border-radius:50%;border:2px solid #ccc;display:block;margin:auto;">
            {% endif %}
        </div>
        <div class="form-group">
            <label for="profile_pic">Change Profile Image:</label>
            {{ form.profile_pic }}
        </div>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" value="{{ user.username }}" readonly class="form-control">
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            {{ form.email }}
        </div>
        <div class="form-group">
            <label for="first_name">First Name:</label>
            {{ form.first_name }}
        </div>
        <div class="form-group">
            <label for="last_name">Last Name:</label>
            {{ form.last_name }}
        </div>
        <div class="form-group">
            <label for="phone">Phone Number:</label>
            {{ form.phone }}
        </div>
        <div class="form-group">
            <label for="address">Address:</label>
            {{ form.address }}
        </div>
        <div class="form-group">
            <label for="password">Change Password:</label>
            {{ form.password }}
        </div>
        <button type="submit" class="btn btn-success">Save Changes</button>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const input = document.querySelector('input[name="profile_pic"]');
        const preview = document.getElementById('profile-pic-preview');
        if (input) {
            input.addEventListener('change', function(e) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(ev) {
                        preview.src = ev.target.result;
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            });
        }
    });
</script>
{% endblock %}
